server {
    listen 80;
    server_name _;

    # Serve the built frontend bundle
    root /usr/share/nginx/html;
    index index.html index.htm;

    # gzip for faster client delivery (especially over tunnels)
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # Common proxy headers to preserve request context
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Interview API (Port 5002)
    location /api/interviews {
        proxy_pass http://host.docker.internal:5002;
    }

    # Shortlisting API (Port 5001)
    location ~ ^/api/(tests|notifications|candidates) {
        proxy_pass http://host.docker.internal:5001;
    }

    # Upload/Core API (Port 8080)
    location /upload {
        client_max_body_size 100M;
        proxy_pass http://host.docker.internal:8080;
    }

    location ~ ^/(profiles|jobs|job|jobs_counts|applications|apply|delete|approve|modify|select_candidates|selected_candidates|create-job-profile)$ {
        proxy_pass http://host.docker.internal:8080;
    }

    # Settings & Monitoring API (Port 5003)
    location /api/settings {
        proxy_pass http://host.docker.internal:5003;
    }

    # SPA fallback
    location / {
        try_files $uri $uri/ /index.html;
    }
}

